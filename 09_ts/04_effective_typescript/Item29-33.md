# :page_facing_up: Item29 ~ 33

<br>

## Item29. 사용할 때는 너그럽게, 생성할 때는 엄격하게

- 함수의 매개변수는 타입의 범위가 넓어도 되지만, 결과를 반환할 때는 일반적으로 타입의 범위가 더 구체적이어야 한다.

---

- 예시) 3D 매핑 API - 카메라의 위치를 지정하고 경계 박스의 뷰포트를 계산

### :star: 사용할 때는 너그럽게

```typescript
declare function setCamera(camera: CameraOptions): void;
declare function viewportForBounds(bounds: LngLatBounds): CameraOptions;
```

- 일부 값은 건드리지 않으면서 동시에 다른 값을 설정할 수 있어야 하므로 `CameraOptions`의 필드는 모두 선택적이다.
- 게다가 `LngLat` 타입도 다양한 형테의 매개변수 타입을 정의하여 편의성을 제공하여 함수 호출을 쉽게 할 수 있다.

```typescript
interface CameraOptions {
  center?: LngLat;
  zoom?: number;
  bearing?: number;
  pitch?: number;
}

type LngLat = { lgn: number; lat: number; } | { lon: number; lat: number; } | [number, number];
```

- 또한 `viewportForBounds` 함수는 위와 같은 자유로운 타입을 매개변수로 받는다.
  - `LngLat` 타입과 조합하면 `LngLatBounds`의 가능한 형태는 19가지 이상으로 매우 자유로운 타입이다.

```typescript
type LngLatBounds = { northeast: LngLat, southwest: LngLat } | [LngLat, LngLat] | [number, number, number, number];
```

<br>

### :star: 생성할 때는 엄격하게

```typescript
function focusOndFeature(f: Feature) {
  const bounds = calculateBoundingBox(f);
  const camera = viewportForBounds(bounds);
  setCamera(camera);
  const { center: { lat, lng }, zoom } = camera;
  // ~~~ ... 형식에 'lat' 속성이 없습니다.
  // ~~~ ... 형식에 'lng' 속성이 없습니다.
  zoom; // 타입이 number | undefined
  window.location.search = `?v=@${lat},${lng}z${zoom}`;
}
```

- 위 오류는 `lat`, `lng` 속성이 없고 `zoom` 속성만 존재하여 발생했고, `zoom`의 타입이 `number | undefined`로 추론되는 것도 역시 문제다.
- 근본적인 문제는 `viewportForBounds`의 타입 선언이 사용될 때뿐만 아니라 만들어질 때도 너무 자유롭다는 것이다.
- `camera` 값을 안전한 타입으로 사용하는 유일한 방법은 **유니온 타입의 각 요소별로 코드를 분기**하는 것이다.

- 유니온 타입의 요소별 분기를 위한 방법은 좌표를 위한 기본 형식을 구분하는 것이다.
  - 배열과 배열 같은 것의 구분을 위해 `LngLat`와 `LngLatLike`를 구분할 수 있다.
  - 또한 `setCamera` 함수가 매개변수로 받을 수 있도록, 완전하게 정의된 `Camera` 타입과 `Camera` 타입이 부분적으로 정의된 버전을 구분할 수도 있다.

```typescript
interface LngLat {
  lng: number;
  lat: number;
}

type LngLatLike = LngLat | { lon: number; lat: number; } | [number, number];

interface Camera {
  center: LngLat;
  zoom: number;
  bearing: number;
  pitch: number;
}

interface CameraOptions extends Omit<Partial<Camera>, 'center'> {
  center?: LngLatLike;
}

type LngLatBounds = { northeast: LngLatLike, southwest: LngLatLike } | [LngLatLike, LngLatLike] | [number, number, number, number];

declare function setCamera(camera: CameraOptions): void;
declare function viewportForBounds(bounds: LngLatBounds): Camera;
```

